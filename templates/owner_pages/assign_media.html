{% extends 'base.html' %}

{% block title %}Assign Media to {{ exhibition.title }} | Owner{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h2>Assign Media to: {{ exhibition.title }}</h2>

    <form method="post">
      {% csrf_token %}

      <div class="row">
        {% for media in all_media %}
          <div class="col-md-4 mb-3">
            <div class="card">
              {% if media.file %}
                {% with url=media.file.url %}
                  {% if url %}
                    {% if media.media_type == 'image' %}
                      <img src="{{ url }}" class="card-img-top" style="height:150px;object-fit:cover;" alt="Media {{ media.pk }}">
                    {% elif media.media_type == 'video' %}
                      <video class="card-img-top" style="height:150px;object-fit:cover;" preload="metadata" controls>
                        <source src="{{ url }}" type="video/mp4">
                        Your browser does not support the video tag.
                      </video>
                    {% else %}
                      <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height:150px;">
                        <a href="{{ url }}" target="_blank" rel="noopener">Open file</a>
                      </div>
                    {% endif %}
                  {% else %}
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height:150px;">No preview</div>
                  {% endif %}
                {% endwith %}
              {% else %}
                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height:150px;">No file</div>
              {% endif %}
              <div class="card-body">
                <h6 class="card-title">{{ media.media_type }}</h6>
                <p class="small text-muted">{{ media.caption }}</p>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="media" value="{{ media.pk }}" id="media-{{ media.pk }}"
                  {% if media.pk in existing_ids %}checked{% endif %}>
                  <label class="form-check-label" for="media-{{ media.pk }}">Include</label>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <button class="btn btn-primary" type="submit">Confirm Selection</button>
  <a class="btn-back btn-back--owner" href="{% url 'owner_app:exhibitions_list' %}">Cancel</a>
    </form>
  </div>
{% endblock %}
